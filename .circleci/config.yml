version: 2.1
executors:
  debian11-amd64:
    docker:
      - image: amd64/debian:bullseye
  debian11-arm64:
    docker:
      - image: arm64v8/debian:bullseye
    resource_class: arm.medium
  debian12-amd64:
    docker:
      - image: amd64/debian:bookworm
  debian12-arm64:
    docker:
      - image: arm64v8/debian:bookworm
    resource_class: arm.medium

commands:
  setup:
    steps:
      - run:
          name: Setup
          command: |
            git clone --depth 1 --branch 3.24.3 https://github.com/flutter/flutter
            PATH="$PATH:`pwd`/flutter/bin"
            flutter doctor -v
            mkdir /tmp/artifacts;
            uname -a > /tmp/artifacts/uname.txt;
            cp /etc/os-release /tmp/artifacts
      - store_artifacts:
          path: /tmp/artifacts
jobs:
  debian11-amd64:
    executor: debian11-amd64
    steps:
      - setup
  debian11-arm64:
    executor: debian11-arm64
    steps:
      - setup
  debian12-amd64:
    executor: debian12-amd64
    steps:
      - setup
  debian12-arm64:
    executor: debian12-arm64
    steps:
      - setup

workflows:
  build:
    jobs:
      - debian11-amd64
      - debian11-arm64
      - debian12-amd64
      - debian12-arm64
